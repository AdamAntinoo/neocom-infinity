package org.dimensinfin.eveonline.neocom.infinity.serializer;

import com.fasterxml.jackson.core.JsonProcessingException;
import com.fasterxml.jackson.databind.ObjectMapper;
import org.junit.Assert;
import org.junit.Test;

import org.dimensinfin.eveonline.neocom.infinity.core.exceptions.ErrorInfo;
import org.dimensinfin.eveonline.neocom.infinity.core.exceptions.NeoComSBException;

import static org.junit.Assert.assertEquals;

public class NeoComSBExceptionSerializerTest {
	private static final ObjectMapper jsonMapper = new ObjectMapper();
	private static final String ERROR_INFO_EXPECTED_SERIALIZATION ="{\"cause\":null,\"stackTrace\":[{\"classLoaderName\":\"app" +
			"\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"errorInfoSerializationCode\"," +
			"\"fileName\":\"NeoComSBExceptionSerializerTest.java\",\"lineNumber\":40,\"className\":\"org.dimensinfin.eveonline" +
			".neocom.infinity.serializer.NeoComSBExceptionSerializerTest\",\"nativeMethod\":false},{\"classLoaderName\":null,\"moduleName\":\"java.base\",\"moduleVersion\":\"11.0.4\",\"methodName\":\"invoke0\",\"fileName\":\"NativeMethodAccessorImpl.java\",\"lineNumber\":-2,\"className\":\"jdk.internal.reflect.NativeMethodAccessorImpl\",\"nativeMethod\":true},{\"classLoaderName\":null,\"moduleName\":\"java.base\",\"moduleVersion\":\"11.0.4\",\"methodName\":\"invoke\",\"fileName\":\"NativeMethodAccessorImpl.java\",\"lineNumber\":62,\"className\":\"jdk.internal.reflect.NativeMethodAccessorImpl\",\"nativeMethod\":false},{\"classLoaderName\":null,\"moduleName\":\"java.base\",\"moduleVersion\":\"11.0.4\",\"methodName\":\"invoke\",\"fileName\":\"DelegatingMethodAccessorImpl.java\",\"lineNumber\":43,\"className\":\"jdk.internal.reflect.DelegatingMethodAccessorImpl\",\"nativeMethod\":false},{\"classLoaderName\":null,\"moduleName\":\"java.base\",\"moduleVersion\":\"11.0.4\",\"methodName\":\"invoke\",\"fileName\":\"Method.java\",\"lineNumber\":566,\"className\":\"java.lang.reflect.Method\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"runReflectiveCall\",\"fileName\":\"FrameworkMethod.java\",\"lineNumber\":50,\"className\":\"org.junit.runners.model.FrameworkMethod$1\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"run\",\"fileName\":\"ReflectiveCallable.java\",\"lineNumber\":12,\"className\":\"org.junit.internal.runners.model.ReflectiveCallable\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"invokeExplosively\",\"fileName\":\"FrameworkMethod.java\",\"lineNumber\":47,\"className\":\"org.junit.runners.model.FrameworkMethod\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"evaluate\",\"fileName\":\"InvokeMethod.java\",\"lineNumber\":17,\"className\":\"org.junit.internal.runners.statements.InvokeMethod\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"runLeaf\",\"fileName\":\"ParentRunner.java\",\"lineNumber\":325,\"className\":\"org.junit.runners.ParentRunner\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"runChild\",\"fileName\":\"BlockJUnit4ClassRunner.java\",\"lineNumber\":78,\"className\":\"org.junit.runners.BlockJUnit4ClassRunner\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"runChild\",\"fileName\":\"BlockJUnit4ClassRunner.java\",\"lineNumber\":57,\"className\":\"org.junit.runners.BlockJUnit4ClassRunner\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"run\",\"fileName\":\"ParentRunner.java\",\"lineNumber\":290,\"className\":\"org.junit.runners.ParentRunner$3\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"schedule\",\"fileName\":\"ParentRunner.java\",\"lineNumber\":71,\"className\":\"org.junit.runners.ParentRunner$1\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"runChildren\",\"fileName\":\"ParentRunner.java\",\"lineNumber\":288,\"className\":\"org.junit.runners.ParentRunner\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"access$000\",\"fileName\":\"ParentRunner.java\",\"lineNumber\":58,\"className\":\"org.junit.runners.ParentRunner\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"evaluate\",\"fileName\":\"ParentRunner.java\",\"lineNumber\":268,\"className\":\"org.junit.runners.ParentRunner$2\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"run\",\"fileName\":\"ParentRunner.java\",\"lineNumber\":363,\"className\":\"org.junit.runners.ParentRunner\",\"nativeMethod\":false},{\"classLoaderName\":null,\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"runTestClass\",\"fileName\":\"JUnitTestClassExecutor.java\",\"lineNumber\":110,\"className\":\"org.gradle.api.internal.tasks.testing.junit.JUnitTestClassExecutor\",\"nativeMethod\":false},{\"classLoaderName\":null,\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"execute\",\"fileName\":\"JUnitTestClassExecutor.java\",\"lineNumber\":58,\"className\":\"org.gradle.api.internal.tasks.testing.junit.JUnitTestClassExecutor\",\"nativeMethod\":false},{\"classLoaderName\":null,\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"execute\",\"fileName\":\"JUnitTestClassExecutor.java\",\"lineNumber\":38,\"className\":\"org.gradle.api.internal.tasks.testing.junit.JUnitTestClassExecutor\",\"nativeMethod\":false},{\"classLoaderName\":null,\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"processTestClass\",\"fileName\":\"AbstractJUnitTestClassProcessor.java\",\"lineNumber\":62,\"className\":\"org.gradle.api.internal.tasks.testing.junit.AbstractJUnitTestClassProcessor\",\"nativeMethod\":false},{\"classLoaderName\":null,\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"processTestClass\",\"fileName\":\"SuiteTestClassProcessor.java\",\"lineNumber\":51,\"className\":\"org.gradle.api.internal.tasks.testing.SuiteTestClassProcessor\",\"nativeMethod\":false},{\"classLoaderName\":null,\"moduleName\":\"java.base\",\"moduleVersion\":\"11.0.4\",\"methodName\":\"invoke0\",\"fileName\":\"NativeMethodAccessorImpl.java\",\"lineNumber\":-2,\"className\":\"jdk.internal.reflect.NativeMethodAccessorImpl\",\"nativeMethod\":true},{\"classLoaderName\":null,\"moduleName\":\"java.base\",\"moduleVersion\":\"11.0.4\",\"methodName\":\"invoke\",\"fileName\":\"NativeMethodAccessorImpl.java\",\"lineNumber\":62,\"className\":\"jdk.internal.reflect.NativeMethodAccessorImpl\",\"nativeMethod\":false},{\"classLoaderName\":null,\"moduleName\":\"java.base\",\"moduleVersion\":\"11.0.4\",\"methodName\":\"invoke\",\"fileName\":\"DelegatingMethodAccessorImpl.java\",\"lineNumber\":43,\"className\":\"jdk.internal.reflect.DelegatingMethodAccessorImpl\",\"nativeMethod\":false},{\"classLoaderName\":null,\"moduleName\":\"java.base\",\"moduleVersion\":\"11.0.4\",\"methodName\":\"invoke\",\"fileName\":\"Method.java\",\"lineNumber\":566,\"className\":\"java.lang.reflect.Method\",\"nativeMethod\":false},{\"classLoaderName\":null,\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"dispatch\",\"fileName\":\"ReflectionDispatch.java\",\"lineNumber\":35,\"className\":\"org.gradle.internal.dispatch.ReflectionDispatch\",\"nativeMethod\":false},{\"classLoaderName\":null,\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"dispatch\",\"fileName\":\"ReflectionDispatch.java\",\"lineNumber\":24,\"className\":\"org.gradle.internal.dispatch.ReflectionDispatch\",\"nativeMethod\":false},{\"classLoaderName\":null,\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"dispatch\",\"fileName\":\"ContextClassLoaderDispatch.java\",\"lineNumber\":32,\"className\":\"org.gradle.internal.dispatch.ContextClassLoaderDispatch\",\"nativeMethod\":false},{\"classLoaderName\":null,\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"invoke\",\"fileName\":\"ProxyDispatchAdapter.java\",\"lineNumber\":93,\"className\":\"org.gradle.internal.dispatch.ProxyDispatchAdapter$DispatchingInvocationHandler\",\"nativeMethod\":false},{\"classLoaderName\":null,\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"processTestClass\",\"fileName\":null,\"lineNumber\":-1,\"className\":\"com.sun.proxy.$Proxy2\",\"nativeMethod\":false},{\"classLoaderName\":null,\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"processTestClass\",\"fileName\":\"TestWorker.java\",\"lineNumber\":118,\"className\":\"org.gradle.api.internal.tasks.testing.worker.TestWorker\",\"nativeMethod\":false},{\"classLoaderName\":null,\"moduleName\":\"java.base\",\"moduleVersion\":\"11.0.4\",\"methodName\":\"invoke0\",\"fileName\":\"NativeMethodAccessorImpl.java\",\"lineNumber\":-2,\"className\":\"jdk.internal.reflect.NativeMethodAccessorImpl\",\"nativeMethod\":true},{\"classLoaderName\":null,\"moduleName\":\"java.base\",\"moduleVersion\":\"11.0.4\",\"methodName\":\"invoke\",\"fileName\":\"NativeMethodAccessorImpl.java\",\"lineNumber\":62,\"className\":\"jdk.internal.reflect.NativeMethodAccessorImpl\",\"nativeMethod\":false},{\"classLoaderName\":null,\"moduleName\":\"java.base\",\"moduleVersion\":\"11.0.4\",\"methodName\":\"invoke\",\"fileName\":\"DelegatingMethodAccessorImpl.java\",\"lineNumber\":43,\"className\":\"jdk.internal.reflect.DelegatingMethodAccessorImpl\",\"nativeMethod\":false},{\"classLoaderName\":null,\"moduleName\":\"java.base\",\"moduleVersion\":\"11.0.4\",\"methodName\":\"invoke\",\"fileName\":\"Method.java\",\"lineNumber\":566,\"className\":\"java.lang.reflect.Method\",\"nativeMethod\":false},{\"classLoaderName\":null,\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"dispatch\",\"fileName\":\"ReflectionDispatch.java\",\"lineNumber\":35,\"className\":\"org.gradle.internal.dispatch.ReflectionDispatch\",\"nativeMethod\":false},{\"classLoaderName\":null,\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"dispatch\",\"fileName\":\"ReflectionDispatch.java\",\"lineNumber\":24,\"className\":\"org.gradle.internal.dispatch.ReflectionDispatch\",\"nativeMethod\":false},{\"classLoaderName\":null,\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"dispatch\",\"fileName\":\"MessageHubBackedObjectConnection.java\",\"lineNumber\":175,\"className\":\"org.gradle.internal.remote.internal.hub.MessageHubBackedObjectConnection$DispatchWrapper\",\"nativeMethod\":false},{\"classLoaderName\":null,\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"dispatch\",\"fileName\":\"MessageHubBackedObjectConnection.java\",\"lineNumber\":157,\"className\":\"org.gradle.internal.remote.internal.hub.MessageHubBackedObjectConnection$DispatchWrapper\",\"nativeMethod\":false},{\"classLoaderName\":null,\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"run\",\"fileName\":\"MessageHub.java\",\"lineNumber\":404,\"className\":\"org.gradle.internal.remote.internal.hub.MessageHub$Handler\",\"nativeMethod\":false},{\"classLoaderName\":null,\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"onExecute\",\"fileName\":\"ExecutorPolicy.java\",\"lineNumber\":63,\"className\":\"org.gradle.internal.concurrent.ExecutorPolicy$CatchAndRecordFailures\",\"nativeMethod\":false},{\"classLoaderName\":null,\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"run\",\"fileName\":\"ManagedExecutorImpl.java\",\"lineNumber\":46,\"className\":\"org.gradle.internal.concurrent.ManagedExecutorImpl$1\",\"nativeMethod\":false},{\"classLoaderName\":null,\"moduleName\":\"java.base\",\"moduleVersion\":\"11.0.4\",\"methodName\":\"runWorker\",\"fileName\":\"ThreadPoolExecutor.java\",\"lineNumber\":1128,\"className\":\"java.util.concurrent.ThreadPoolExecutor\",\"nativeMethod\":false},{\"classLoaderName\":null,\"moduleName\":\"java.base\",\"moduleVersion\":\"11.0.4\",\"methodName\":\"run\",\"fileName\":\"ThreadPoolExecutor.java\",\"lineNumber\":628,\"className\":\"java.util.concurrent.ThreadPoolExecutor$Worker\",\"nativeMethod\":false},{\"classLoaderName\":null,\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"run\",\"fileName\":\"ThreadFactoryImpl.java\",\"lineNumber\":55,\"className\":\"org.gradle.internal.concurrent.ThreadFactoryImpl$ManagedThreadRunnable\",\"nativeMethod\":false},{\"classLoaderName\":null,\"moduleName\":\"java.base\",\"moduleVersion\":\"11.0.4\",\"methodName\":\"run\",\"fileName\":\"Thread.java\",\"lineNumber\":834,\"className\":\"java.lang.Thread\",\"nativeMethod\":false}],\"sourceClass\":\"org.dimensinfin.eveonline.neocom.infinity.serializer.NeoComSBExceptionSerializerTest\",\"sourceMethod\":\"errorInfoSerializationCode\",\"rootException\":null,\"message\":\"TokenTranslationResponse response is not valid.\",\"httpStatus\":\"BAD_REQUEST\",\"exceptionType\":\"NeoComSBException\",\"suppressed\":[],\"localizedMessage\":\"TokenTranslationResponse response is not valid.\"}";

	@Test
	public void errorInfoSerialization() {
		final NeoComSBException value = new NeoComSBException( ErrorInfo.AUTHORIZATION_TRANSLATION );
		Assert.assertNotNull(value);
		final int httpStatusCode = value.getHttpStatus().value();
		Assert.assertEquals( 400, httpStatusCode );
		final String httpStatusName = value.getHttpStatus().name();
		Assert.assertEquals( "BAD_REQUEST", httpStatusName );
		final String classLongName = value.getSourceClass();
		Assert.assertEquals( "org.dimensinfin.eveonline.neocom.infinity.serializer.NeoComSBExceptionSerializerTest",
				classLongName );
		final String[] nameParts = classLongName.split( "\\." );
		final String className = nameParts[nameParts.length-1];
		Assert.assertEquals( "NeoComSBExceptionSerializerTest", className );
		final String sourceMethod = value.getSourceMethod();
		Assert.assertEquals( "errorInfoSerialization", sourceMethod );
	}

	@Test
	public void errorInfoSerializationCode() throws JsonProcessingException {
		final NeoComSBException value = new NeoComSBException( ErrorInfo.AUTHORIZATION_TRANSLATION );
		String json = jsonMapper.writeValueAsString(value);

		assertEquals(ERROR_INFO_EXPECTED_SERIALIZATION, json);

	}
}